{"version":3,"sources":["form-save.js"],"names":["getKeys","keys","formFields","document","querySelectorAll","f","length","parent","getFormElement","key","id","push","elem","nodeName","toLowerCase","parentNode","feature","addEventListener","window","i","store","get","formId","split","getElementById","value","timerId","setInterval","saved","inputs","set","alertify","logPosition","success","forms","form","clearInterval","storedKeys","indexOf","remove"],"mappings":"AA6CA,QAASA,WAGL,IAAK,GAFDC,MACAC,EAAaC,SAASC,iBAAiB,8BAClCC,EAAI,EAAGA,EAAIH,EAAWI,OAAQD,IAAK,CACxC,GAAIE,GAASC,eAAeN,EAAWG,GACvC,IAAIE,KAAW,EAAO,CAClB,GAAIE,GAAMF,EAAOG,GAAK,IAAMR,EAAWG,GAAGK,EAC1CT,GAAKU,KAAKF,IAGlB,MAAOR,GAEX,QAASO,gBAAeI,GACpB,GAAoC,SAAhCA,EAAKC,SAASC,cAA0B,CACxC,GAAIP,GAASK,EAAKG,UAClB,OAAsC,SAAlCR,EAAOM,SAASC,cACTP,EAEAC,eAAeD,GAG1B,OAAO,EAjEf,GAAIS,UACAC,mBAAqBC,OAAOD,iBAC5Bb,mBAAqBD,SAASC,iBAGlC,IAAIY,QAAQC,kBAAoBD,QAAQZ,iBAEpC,IAAK,GADDH,MAAOD,UACFmB,EAAI,EAAGA,EAAIlB,KAAKK,OAAQa,IAC7B,GAAIC,MAAMC,IAAIpB,KAAKkB,IAAK,CACpB,GAAIG,QAASrB,KAAKkB,GAAGI,MAAM,KAAK,EAChCpB,UAASqB,eAAeF,QAAQG,MAAQL,MAAMC,IAAIpB,KAAKkB,IAqBnE,IAAK,GAhBDO,SAAUR,OAAOS,YAAY,WAG7B,IAAK,GAFDC,IAAQ,EACRC,EAAS1B,SAASC,iBAAiB,8BAC9Be,EAAI,EAAGA,EAAIU,EAAOvB,OAAQa,IAAK,CACpC,GAAIV,GAAMD,eAAeqB,EAAOV,IAAIT,GAAK,IAAMmB,EAAOV,GAAGT,EACrDU,OAAMC,IAAIZ,KAASoB,EAAOV,GAAGM,OAA6B,KAApBI,EAAOV,GAAGM,QAChDL,MAAMU,IAAIrB,EAAKoB,EAAOV,GAAGM,OACzBG,GAAQ,GAGZA,KAAU,IACVG,SAASC,YAAY,aACrBD,SAASE,QAAQ,qBAEtB,KACCC,MAAQ/B,SAASC,iBAAiB,QAC7BC,EAAI,EAAGA,EAAI6B,MAAM5B,OAAQD,IAAK,CACnC,GAAI8B,MAAOD,MAAM7B,EACjB8B,MAAKlB,iBAAiB,SAAU,WAC5BC,OAAOkB,cAAcV,QAGrB,KAAK,GAFDJ,GAASa,KAAKzB,GACd2B,EAAajB,MAAMnB,OACdkB,EAAI,EAAGA,EAAIkB,EAAW/B,OAAQa,IAC/BkB,EAAWlB,GAAGmB,QAAQhB,IAAU,GAChCF,MAAMmB,OAAOF,EAAWlB","file":"form-save.js","sourcesContent":["/* global alertify, store */\nvar feature = {\n    addEventListener : !!window.addEventListener,\n    querySelectorAll : !!document.querySelectorAll\n};\n\nif (feature.addEventListener && feature.querySelectorAll) {\n    var keys = getKeys();\n    for (var i = 0; i < keys.length; i++) {\n        if (store.get(keys[i])) {\n            var formId = keys[i].split('~')[1];\n            document.getElementById(formId).value = store.get(keys[i]);\n        }\n    }\n}\n\nvar timerId = window.setInterval(function() {\n    var saved = false;\n    var inputs = document.querySelectorAll('input[type=text], textarea');\n    for (var i = 0; i < inputs.length; i++) {\n        var key = getFormElement(inputs[i]).id + '~' + inputs[i].id;\n        if (store.get(key) !== inputs[i].value && inputs[i].value !== '') {\n            store.set(key, inputs[i].value);\n            saved = true;\n        }\n    }\n    if (saved === true) {\n        alertify.logPosition('top right');\n        alertify.success('Auto saved text');\n    }\n}, 5000);\nvar forms = document.querySelectorAll('form');\nfor (var f = 0; f < forms.length; f++) {\n    var form = forms[f];\n    form.addEventListener('submit', function() {\n        window.clearInterval(timerId);\n        var formId = form.id;\n        var storedKeys = store.keys();\n        for (var i = 0; i < storedKeys.length; i++) {\n            if (storedKeys[i].indexOf(formId) > -1) {\n                store.remove(storedKeys[i]);\n            }\n        }\n    });\n}\nfunction getKeys() {\n    var keys = [];\n    var formFields = document.querySelectorAll('input[type=text], textarea');\n    for (var f = 0; f < formFields.length; f++) {\n        var parent = getFormElement(formFields[f]);\n        if (parent !== false) {\n            var key = parent.id + '~' + formFields[f].id;\n            keys.push(key);\n        }\n    }\n    return keys;\n}\nfunction getFormElement(elem) {\n    if (elem.nodeName.toLowerCase() !== 'body') {\n        var parent = elem.parentNode;\n        if (parent.nodeName.toLowerCase() === 'form') {\n            return parent;\n        } else {\n            return getFormElement(parent);\n        }\n    } else {\n        return false;\n    }\n}\n"],"sourceRoot":"/source/"}